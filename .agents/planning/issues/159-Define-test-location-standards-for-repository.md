---
number: 159
title: "Define test location standards for repository"
state: OPEN
created_at: 12/20/2025 10:18:30
author: rjmurillo-bot
labels: ["documentation", "enhancement"]
assignees: []
milestone: null
url: https://github.com/rjmurillo/ai-agents/issues/159
---

# Define test location standards for repository

## Problem

Tests are scattered across multiple locations in the repository:
- `tests/` - Root tests directory
- `.claude/skills/github/tests/` - Skill-specific tests
- Other locations

This lack of standardization makes it unclear where tests should be placed and harder to maintain consistency.

## Current State

No documented standard for test file locations.

## Proposed Solution

Define and document a clear standard:

### Option A: Colocated Tests

Tests live alongside the code they test:
```
.claude/skills/github/scripts/pr/Get-PRContext.ps1
.claude/skills/github/scripts/pr/Get-PRContext.Tests.ps1
```

### Option B: Centralized Tests

All tests in root `tests/` with mirrored structure:
```
tests/
  skills/
    github/
      Get-PRContext.Tests.ps1
```

### Option C: Per-Module Tests

Each module has its own tests directory:
```
.claude/skills/github/tests/
.github/scripts/tests/
```

## Acceptance Criteria

- [ ] Standard documented in AGENTS.md or CONTRIBUTING.md
- [ ] Existing tests consolidated to follow standard
- [ ] PR review checklist includes test location verification

## Related

- PR #147 - Tests in scattered locations
- Skill-Review-005: Cohesion check for new files

---

Generated with [Claude Code](https://claude.com/claude-code)

---

## Comments

### Comment by @coderabbitai on 12/20/2025 10:20:22

<!-- This is an auto-generated issue plan by CodeRabbit -->


### üìù CodeRabbit Plan Mode
Generate an implementation plan and prompts that you can use with your favorite coding agent.

- [ ] <!-- {"checkboxId": "8d4f2b9c-3e1a-4f7c-a9b2-d5e8f1c4a7b9"} --> Create Plan

<details>
<summary>Examples</summary>

- [Example 1](https://github.com/coderabbitai/git-worktree-runner/issues/29#issuecomment-3589134556)
- [Example 2](https://github.com/coderabbitai/git-worktree-runner/issues/12#issuecomment-3606665167)

</details>

---

<details>
<summary><b>üîó Similar Issues</b></summary>

**Related Issues**
- https://github.com/rjmurillo/ai-agents/issues/65
- https://github.com/rjmurillo/ai-agents/issues/157
- https://github.com/rjmurillo/ai-agents/issues/139
</details>
<details>
<summary><b>üë§ Suggested Assignees</b></summary>

- [rjmurillo-bot](https://github.com/rjmurillo-bot)
- [coderabbitai](https://github.com/coderabbitai)
</details>


---
<details>
<summary> üß™ Issue enrichment is currently in open beta.</summary>


You can configure auto-planning by selecting labels in the issue_enrichment configuration.

To disable automatic issue enrichment, add the following to your `.coderabbit.yaml`:
```yaml
issue_enrichment:
  auto_enrich:
    enabled: false
```
</details>

üí¨ Have feedback or questions? Drop into our [discord](https://discord.gg/coderabbit) or [schedule a call](https://calendly.com/parth-coderabbit/issues-feedback)!

### Comment by @github-actions on 12/20/2025 10:21:58

<!-- AI-PRD-GENERATION -->

## üìã Product Requirements Document

> [!IMPORTANT]
> This PRD was automatically generated based on issue triage escalation.
> **Complexity Score**: 6/12 ()
> **Escalation Criteria**: feature_request, research_required

<details>
<summary>üìñ About this PRD</summary>

This PRD was generated by the **Explainer Agent** after the issue was flagged
for detailed analysis. The document is designed to be self-contained - it can
be passed to a separate AI agent instance for implementation without additional
context.

**PRD Depth Levels**:
- **Standard** (4-6): Brief analysis, clear requirements
- **Detailed** (7-9): Research section, blocking questions
- **Comprehensive** (10-12): Phased implementation, risk analysis

</details>

---

Let me gather more information about the current test locations in the repository.

Now I have a complete picture of the current test locations. Let me create the PRD.

The file system denied write access. I'll output the PRD content directly since I cannot create the file.

---

# PRD: Test Location Standards

## Executive Summary

Tests are scattered across multiple locations in the repository with no documented standard. This creates confusion about where to place new tests and makes maintenance harder.

| Scope | Status | Blocker |
|-------|--------|---------|
| Document test location standard | :green_circle: READY | None |
| Consolidate existing tests | :green_circle: READY | None |
| Add PR review checklist item | :green_circle: READY | None |

**Verdict**: READY. All information needed is available. No external dependencies or blocking questions.

## Problem Statement

### Current State

| Location | Contents | Count |
|----------|----------|-------|
| `tests/` | `Check-SkillExists.Tests.ps1` | 1 file |
| `scripts/tests/` | Installation script tests | 6 files |
| `build/tests/` | Agent generation tests | 1 file |

### Gap Analysis

1. **No documented standard**: No guidance exists for where tests belong
2. **Inconsistent placement**: Tests exist in 3 different locations
3. **Discovery friction**: Developers must search multiple directories
4. **Maintenance burden**: Updates require checking multiple locations

### User Impact

| User Type | Impact |
|-----------|--------|
| Contributors | Uncertainty about test placement |
| Reviewers | Must verify test location manually |
| Agents | No clear guidance in steering files |

## Research Findings

### Current Test Inventory

**Source**: Direct repository inspection (CONFIRMED)

| File | Location | Tests For |
|------|----------|-----------|
| `Check-SkillExists.Tests.ps1` | `tests/` | `scripts/Check-SkillExists.ps1` |
| `Install-Common.Tests.ps1` | `scripts/tests/` | `scripts/lib/Install-Common.psm1` |
| `Config.Tests.ps1` | `scripts/tests/` | `scripts/lib/Config.psd1` |
| `install.Tests.ps1` | `scripts/tests/` | `scripts/install.ps1` |
| `Sync-McpConfig.Tests.ps1` | `scripts/tests/` | `scripts/Sync-McpConfig.ps1` |
| `Validate-Consistency.Tests.ps1` | `scripts/tests/` | `scripts/Validate-Consistency.ps1` |
| `Validate-SessionProtocol.Tests.ps1` | `scripts/tests/` | `scripts/Validate-SessionProtocol.ps1` |
| `Generate-Agents.Tests.ps1` | `build/tests/` | `build/Generate-Agents.ps1` |

### Existing Test Runner Configuration

**Source**: `AGENTS.md` lines 878-909 (CONFIRMED)

The repository uses `build/scripts/Invoke-PesterTests.ps1` as the test runner. Current behavior:

- Runs tests from `scripts/tests/` by default
- Supports `-TestPath` parameter for specific files
- Outputs to `artifacts/pester-results.xml`

### Pattern Analysis

The current pattern follows a **per-module tests directory** approach:

- `scripts/tests/` contains tests for `scripts/` code
- `build/tests/` contains tests for `build/` code
- `tests/` appears to be a catch-all for orphaned tests

## Proposed Solution

### Recommendation: Per-Module Tests Directory (Option C)

Each module maintains its own `tests/` subdirectory. Tests live adjacent to the code they test.

**Rationale**:

1. **Cohesion**: Tests stay with their subject code
2. **Discoverability**: Look in `module/tests/` for `module/` tests
3. **Existing pattern**: Already used for `scripts/` and `build/`
4. **Minimal migration**: Only 1 file needs moving

### Phase 1: Document Standard (Status: READY)

**Estimated Effort**: S (1-2 hours)

**Blockers**: None

| Task | Description |
|------|-------------|
| 1.1 | Add test location standard to CONTRIBUTING.md |
| 1.2 | Update `.agents/steering/testing-approach.md` with location rules |
| 1.3 | Add anti-pattern examples |

### Phase 2: Consolidate Tests (Status: READY)

**Estimated Effort**: S (30 minutes)

**Blockers**: None

**Depends on**: Phase 1 complete

| Task | Description |
|------|-------------|
| 2.1 | Move `tests/Check-SkillExists.Tests.ps1` to `scripts/tests/` |
| 2.2 | Update any references to old location |
| 2.3 | Delete empty `tests/` directory |

### Phase 3: Update Test Runner (Status: READY)

**Estimated Effort**: S (30 minutes)

**Blockers**: None

**Depends on**: Phase 2 complete

| Task | Description |
|------|-------------|
| 3.1 | Verify `Invoke-PesterTests.ps1` discovers tests in all locations |
| 3.2 | Update runner if needed to scan `*/tests/` pattern |

### Phase 4: PR Review Checklist (Status: READY)

**Estimated Effort**: S (15 minutes)

**Blockers**: None

**Depends on**: Phase 1 complete

| Task | Description |
|------|-------------|
| 4.1 | Add test location verification to PR review checklist |

## Functional Requirements

### FR-1: Test Location Standard

**Priority**: P1

| ID | Requirement | Acceptance Criteria |
|----|-------------|---------------------|
| FR-1.1 | Tests MUST reside in a `tests/` subdirectory of the module they test | `scripts/foo.ps1` has tests at `scripts/tests/foo.Tests.ps1` |
| FR-1.2 | Test files MUST use `.Tests.ps1` suffix | All test files match `*.Tests.ps1` pattern |
| FR-1.3 | Tests MUST be discoverable by existing test runner | `Invoke-PesterTests.ps1` finds and runs all tests |

### FR-2: Documentation

**Priority**: P1

| ID | Requirement | Acceptance Criteria |
|----|-------------|---------------------|
| FR-2.1 | Standard documented in CONTRIBUTING.md | Section exists with examples |
| FR-2.2 | Steering file updated with location rules | `.agents/steering/testing-approach.md` includes location guidance |

### FR-3: Migration

**Priority**: P2

| ID | Requirement | Acceptance Criteria |
|----|-------------|---------------------|
| FR-3.1 | Orphaned tests moved to correct location | `tests/` directory empty or deleted |
| FR-3.2 | No broken test references | All tests pass after migration |

## Non-Functional Requirements

### Consistency

The standard aligns with existing patterns in `scripts/tests/` and `build/tests/`.

### Testability

Test runner must discover tests in all `*/tests/` directories.

### Documentation

- CONTRIBUTING.md updated with test location section
- Steering file updated for agent guidance

## Technical Design

### Directory Structure After Implementation

```text
.
‚îú‚îÄ‚îÄ build/
‚îÇ   ‚îú‚îÄ‚îÄ Generate-Agents.ps1
‚îÇ   ‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Generate-Agents.Tests.ps1
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ Check-SkillExists.ps1
‚îÇ   ‚îú‚îÄ‚îÄ install.ps1
‚îÇ   ‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Config.psd1
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Install-Common.psm1
‚îÇ   ‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Check-SkillExists.Tests.ps1  # MOVED from tests/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Config.Tests.ps1
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Install-Common.Tests.ps1
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ install.Tests.ps1
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Sync-McpConfig.Tests.ps1
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Validate-Consistency.Tests.ps1
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Validate-SessionProtocol.Tests.ps1
‚îú‚îÄ‚îÄ tests/  # DELETED (empty after migration)
```

### CONTRIBUTING.md Addition

```markdown
## Test Location Standards

Tests reside in a `tests/` subdirectory of the module they test.

### Pattern

| Module | Test Location |
|--------|---------------|
| `scripts/foo.ps1` | `scripts/tests/foo.Tests.ps1` |
| `build/bar.ps1` | `build/tests/bar.Tests.ps1` |
| `scripts/lib/Baz.psm1` | `scripts/tests/Baz.Tests.ps1` |

### Anti-Patterns

| Anti-Pattern | Correct |
|--------------|---------|
| `tests/scripts/foo.Tests.ps1` | `scripts/tests/foo.Tests.ps1` |
| `foo.Tests.ps1` (root) | `scripts/tests/foo.Tests.ps1` |
| `scripts/foo.Tests.ps1` (colocated) | `scripts/tests/foo.Tests.ps1` |

### Rationale

1. **Cohesion**: Tests stay with their subject code
2. **Discoverability**: Predictable location reduces search time
3. **Consistency**: Matches existing patterns in this repository
```

### Steering File Update

Add to `.agents/steering/testing-approach.md`:

```markdown
## Test Location

**Rule**: Tests MUST reside in a `tests/` subdirectory of the module they test.

**Pattern**: `{module}/tests/{script}.Tests.ps1`

**Examples**:
- `scripts/Check-SkillExists.ps1` ‚Üí `scripts/tests/Check-SkillExists.Tests.ps1`
- `build/Generate-Agents.ps1` ‚Üí `build/tests/Generate-Agents.Tests.ps1`

**Anti-Patterns**:
- Root `tests/` directory for module-specific tests
- Colocated tests (same directory as source)
- Deeply nested test directories

**Enforcement**: PR review checklist includes test location verification.
```

## Implementation Plan

### Prerequisites

- Write access to repository
- Ability to run tests locally

### Phase 1: Document Standard

1. Edit `CONTRIBUTING.md` to add test location section
2. Edit `.agents/steering/testing-approach.md` to add location rules
3. Commit with message: `docs: add test location standards`

### Phase 2: Migrate Tests

1. Move `tests/Check-SkillExists.Tests.ps1` to `scripts/tests/`
2. Update path reference in test file (`$scriptPath` line 13)
3. Run tests to verify: `pwsh build/scripts/Invoke-PesterTests.ps1`
4. Delete empty `tests/` directory
5. Commit with message: `refactor: consolidate tests to per-module directories`

### Phase 3: Verify Test Runner

1. Run full test suite
2. Verify all tests discovered and pass
3. No changes expected if runner already scans `scripts/tests/`

### Decision Tree

```text
Does the test file already exist?
‚îú‚îÄ‚îÄ YES ‚Üí Verify it follows the standard
‚îÇ         ‚îú‚îÄ‚îÄ Correct location ‚Üí No action
‚îÇ         ‚îî‚îÄ‚îÄ Wrong location ‚Üí Move to correct location
‚îî‚îÄ‚îÄ NO ‚Üí Create in {module}/tests/{script}.Tests.ps1
```

## Risks and Mitigations

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Test path breaks after move | Low | Medium | Update relative path in test file |
| CI fails to find moved tests | Low | High | Verify runner before merging |
| Confusion during transition | Low | Low | Document in PR description |

## Success Metrics

| Metric | Target |
|--------|--------|
| Tests in per-module directories | 100% |
| Documentation coverage | Standard in CONTRIBUTING.md and steering |
| Test discovery | All tests found by runner |
| Root `tests/` directory | Deleted |

## Blocking Questions

None. All information needed is available from repository inspection.

## Open Questions (Non-Blocking)

1. **Q**: Should the PR template include a test location checkbox?
   - **Hypothesis**: Not needed if documented in CONTRIBUTING.md
   - **Status**: Can be added later if reviewers request it

2. **Q**: Should CI validate test locations?
   - **Hypothesis**: Manual review sufficient for current repository size
   - **Status**: Can be automated if violations become frequent

## Appendices

### Appendix A: Research Sources

| Source | Type | Link |
|--------|------|------|
| Repository structure | Direct inspection | N/A |
| AGENTS.md testing section | Documentation | Lines 878-909 |
| Current test files | Direct inspection | N/A |

### Appendix B: File Inventory

| Current Location | New Location | Action |
|------------------|--------------|--------|
| `tests/Check-SkillExists.Tests.ps1` | `scripts/tests/Check-SkillExists.Tests.ps1` | Move |
| `scripts/tests/*.Tests.ps1` | `scripts/tests/*.Tests.ps1` | No change |
| `build/tests/*.Tests.ps1` | `build/tests/*.Tests.ps1` | No change |

### Appendix C: Related Issues

- PR #147 (mentioned in issue): Tests in scattered locations
- Skill-Review-005 (mentioned in issue): Cohesion check for new files

---

**Handoff**: Recommend orchestrator routes to **critic** for plan validation, then **implementer** for execution.

---

<sub>üìã Generated by [AI PRD Generation](https://github.com/rjmurillo/ai-agents) ¬∑ [View Workflow](https://github.com/rjmurillo/ai-agents/actions/runs/20392963129)</sub>



### Comment by @github-actions on 12/20/2025 10:22:00

<!-- AI-ISSUE-TRIAGE -->

## AI Triage Summary

> [!NOTE]
> This issue has been automatically triaged by AI agents

<details>
<summary>What is AI Triage?</summary>

This issue was analyzed by AI agents:

- **Analyst Agent**: Categorizes the issue and suggests appropriate labels
- **Roadmap Agent**: Aligns the issue with project milestones and priorities
- **Explainer Agent** (if escalated): Generates comprehensive PRD

</details>

### Triage Results

| Property | Value |
|:---------|:------|
| **Category** | `enhancement` |
| **Labels** | enhancement area-infrastructure |
|  **Priority** | `P2` |
| **Milestone** | v1.1 |
| **PRD Escalation** | Generated (see below) |

<details>
<summary>Categorization Analysis</summary>

```json
```json
{
  "labels": ["enhancement", "area-infrastructure"],
  "category": "enhancement",
  "confidence": 0.9,
  "reasoning": "Issue proposes establishing test location standards with multiple options and acceptance criteria for documentation and consolidation"
}
```

```

</details>

<details>
<summary>Roadmap Alignment</summary>

```json
Based on my analysis of the issue and roadmap context:

**Issue Analysis:**

- Type: Enhancement/documentation - defines test location standards
- Scope: Repository-wide test organization policy
- Impact: Medium - affects maintainability and consistency
- Urgency: Not immediate - no blockers on current work
- Complexity: Low-to-moderate research needed to evaluate 3 options

**Alignment:**

- No direct epic alignment - this is process/documentation infrastructure
- Supports maintainability goals of v1.1 (reduced friction for contributors)
- Related to PR #147 mentioned in issue

**PRD Evaluation:**

- Feature request: Yes (new standard)
- Research required: Yes (3 options to evaluate, no clear winner)
- Multi-phase: No (documentation + consolidation can be one effort)
- External dependency: No
- Architectural impact: Low (file organization, not code structure)
- Complexity score: 6 (medium scope, internal only, some unknowns, internal stakeholders)

```json
{
  "milestone": "v1.1",
  "priority": "P2",
  "epic_alignment": "",
  "confidence": 0.80,
  "reasoning": "Process/documentation infrastructure supporting v1.1 maintainability goals; requires research to evaluate 3 options before implementation.",
  "escalate_to_prd": true,
  "escalation_criteria": ["feature_request", "research_required"],
  "complexity_score": 6
}
```

```

</details>

---

<sub>Powered by [AI Issue Triage](https://github.com/rjmurillo/ai-agents) - [View Workflow](https://github.com/rjmurillo/ai-agents/actions/runs/20392963129)</sub>


