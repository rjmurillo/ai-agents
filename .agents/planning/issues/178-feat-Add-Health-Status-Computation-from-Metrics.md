---
number: 178
title: "feat: Add Health Status Computation from Metrics"
state: OPEN
created_at: 12/20/2025 11:12:50
author: rjmurillo-bot
labels: ["enhancement", "priority:P2"]
assignees: []
milestone: null
url: https://github.com/rjmurillo/ai-agents/issues/178
---

# feat: Add Health Status Computation from Metrics

## Summary

Implement health status computation that synthesizes metrics into actionable status indicators (healthy, warning, error).

## Background

Claude-flow's MetricsReader.getOverallHealth() computes health status based on thresholds for memory usage, CPU load, and task failure rates. This provides immediate visibility into system issues.

## Current State

- No health status computation
- No threshold-based alerting
- Manual observation of issues
- No optimization recommendations

## Proposed Solution

1. **Health Status Levels**:
   - `healthy`: All metrics within normal range
   - `warning`: Some metrics approaching thresholds
   - `error`: Critical metrics exceeded, action required
   
2. **Threshold Configuration**:
   - Memory usage (warning: 70%, error: 90%)
   - Task failure rate (warning: 10%, error: 25%)
   - Session duration (warning if abnormally long)
   - Agent spawn failures
   
3. **Health Check API**:
   - getOverallHealth(): Aggregate status
   - getComponentHealth(component): Per-component status
   - getHealthHistory(): Trend over time
   
4. **Optimization Recommendations**:
   - Suggest actions for warning/error states
   - Link to relevant documentation
   - Track recommendation outcomes

## Benefits

- Early warning for system issues
- Actionable status indicators
- Data-driven optimization guidance
- Reduced manual monitoring

## Implementation Notes

- Depends on metrics collection (Issue #169)
- Add status command for CLI
- Consider integration with monitoring dashboard
- Support custom threshold configuration

## Reference

See claude-flow's MetricsReader.getOverallHealth() (wiki page 5.3).

## Dependencies

- #169 (Metrics Collection)

## Analysis Document

`.agents/analysis/claude-flow-architecture-analysis.md`

---

## Comments

### Comment by @coderabbitai on 12/20/2025 11:14:19

<!-- This is an auto-generated issue plan by CodeRabbit -->


### üìù CodeRabbit Plan Mode
Generate an implementation plan and prompts that you can use with your favorite coding agent.

- [ ] <!-- {"checkboxId": "8d4f2b9c-3e1a-4f7c-a9b2-d5e8f1c4a7b9"} --> Create Plan

<details>
<summary>Examples</summary>

- [Example 1](https://github.com/coderabbitai/git-worktree-runner/issues/29#issuecomment-3589134556)
- [Example 2](https://github.com/coderabbitai/git-worktree-runner/issues/12#issuecomment-3606665167)

</details>

---

<details>
<summary><b>üîó Similar Issues</b></summary>

**Possible Duplicates**
- https://github.com/rjmurillo/ai-agents/issues/169

**Related Issues**
- https://github.com/rjmurillo/ai-agents/issues/7
- https://github.com/rjmurillo/ai-agents/issues/170
- https://github.com/rjmurillo/ai-agents/issues/168
- https://github.com/rjmurillo/ai-agents/issues/173
</details>
<details>
<summary><b>üë§ Suggested Assignees</b></summary>

- [rjmurillo-bot](https://github.com/rjmurillo-bot)
- [rjmurillo](https://github.com/rjmurillo)
</details>


---
<details>
<summary> üß™ Issue enrichment is currently in open beta.</summary>


You can configure auto-planning by selecting labels in the issue_enrichment configuration.

To disable automatic issue enrichment, add the following to your `.coderabbit.yaml`:
```yaml
issue_enrichment:
  auto_enrich:
    enabled: false
```
</details>

üí¨ Have feedback or questions? Drop into our [discord](https://discord.gg/coderabbit) or [schedule a call](https://calendly.com/parth-coderabbit/issues-feedback)!

### Comment by @github-actions on 12/20/2025 11:17:06

<!-- AI-PRD-GENERATION -->

## üìã Product Requirements Document

> [!IMPORTANT]
> This PRD was automatically generated based on issue triage escalation.
> **Complexity Score**: 9/12 ()
> **Escalation Criteria**: feature_request, research_required, external_dependency, multi_phase_work

<details>
<summary>üìñ About this PRD</summary>

This PRD was generated by the **Explainer Agent** after the issue was flagged
for detailed analysis. The document is designed to be self-contained - it can
be passed to a separate AI agent instance for implementation without additional
context.

**PRD Depth Levels**:
- **Standard** (4-6): Brief analysis, clear requirements
- **Detailed** (7-9): Research section, blocking questions
- **Comprehensive** (10-12): Phased implementation, risk analysis

</details>

---

Let me gather more context about the current codebase architecture and related issues.

Now let me check if there are any existing scripts or utilities in the project to understand the implementation patterns.

Now I have enough context. Let me create the PRD for Issue #170 (Health Status Computation from Metrics).

The file system is read-only in this environment. Here is the complete PRD for Issue #170:

---

# PRD: Health Status Computation from Metrics

## Introduction/Overview

This feature implements health status computation that synthesizes agent metrics into actionable status indicators (healthy, warning, error). The system provides immediate visibility into agent system issues through threshold-based alerting and optimization recommendations, modeled after claude-flow's MetricsReader.getOverallHealth() pattern.

| Scope | Status | Blocker |
|-------|--------|---------|
| Health status levels (healthy/warning/error) | :green_circle: READY | None |
| Threshold configuration | :green_circle: READY | None |
| Health Check API | :yellow_circle: PARTIAL | Design decision needed (see Q1) |
| Optimization recommendations | :yellow_circle: PARTIAL | Depends on metrics collection (#169) |
| CLI integration | :green_circle: READY | None |

**Verdict**: PARTIAL - Core functionality ready. Blocked on #169 for full metrics integration.

---

## Problem Statement

### Current State

| Aspect | Current Implementation | Gap |
|--------|------------------------|-----|
| Health status computation | None | No automated health synthesis |
| Threshold-based alerting | None | Manual observation required |
| Metrics dashboard | Template exists (`.agents/metrics/dashboard-template.md`) | No data population |
| Baseline metrics | Documented (`.agents/metrics/baseline-report.md`) | No real-time computation |

### User Impact

| User | Impact | Severity |
|------|--------|----------|
| Agent operators | Cannot quickly assess system health | HIGH |
| Developers | Spend time manually analyzing metrics | MEDIUM |

---

## Proposed Solution

### Phase 1: Core Health Computation (READY)

**Effort**: M (2-4 hours) | **Blockers**: None

| Task | Description |
|------|-------------|
| 1.1 | Create `scripts/lib/Metrics.psm1` module |
| 1.2 | Implement `Get-OverallHealth` function |
| 1.3 | Implement `Get-ComponentHealth` function |
| 1.4 | Create Pester tests |

### Phase 2: Threshold Configuration (READY)

**Effort**: S (1-2 hours) | **Blockers**: None

| Task | Description |
|------|-------------|
| 2.1 | Add health thresholds to `scripts/lib/Config.psd1` |
| 2.2 | Support environment variable overrides |

### Phase 3: CLI Integration (READY)

**Effort**: S (1-2 hours) | **Blockers**: None

| Task | Description |
|------|-------------|
| 3.1 | Create `scripts/Get-AgentHealth.ps1` CLI command |
| 3.2 | Support output formats: console, json, markdown |

### Phase 4: Metrics Integration (DEPENDS on #169)

**Effort**: M (2-4 hours) | **Blockers**: Issue #169

| Task | Description |
|------|-------------|
| 4.1 | Integrate with metrics collection from #169 |
| 4.2 | Implement `Get-HealthHistory` for trend analysis |
| 4.3 | Add optimization recommendations |

---

## Functional Requirements

### FR-1: Health Status Levels (P0)

| ID | Requirement | Acceptance Criteria |
|----|-------------|---------------------|
| FR-1.1 | System MUST compute three levels: healthy, warning, error | Unit tests verify all three states |
| FR-1.2 | Return "healthy" when ALL metrics within normal range | Tests confirm healthy when all metrics below warning threshold |
| FR-1.3 | Return "warning" when ANY metric approaches threshold | Tests confirm warning state |
| FR-1.4 | Return "error" when ANY critical metric exceeds threshold | Tests confirm error state |

### FR-2: Threshold Configuration (P0)

| ID | Requirement | Acceptance Criteria |
|----|-------------|---------------------|
| FR-2.1 | Support configurable warning thresholds | Config.psd1 contains thresholds |
| FR-2.2 | Support configurable error thresholds | Config.psd1 contains thresholds |
| FR-2.3 | Defaults: Warning 70%/10%, Error 90%/25% | Matches issue specification |

### FR-3: Health Check API (P1)

| ID | Requirement | Acceptance Criteria |
|----|-------------|---------------------|
| FR-3.1 | `Get-OverallHealth` returns aggregate status | Single value: healthy/warning/error |
| FR-3.2 | `Get-ComponentHealth` returns per-component status | Hashtable with component statuses |
| FR-3.3 | Include reason codes for non-healthy status | ReasonCodes array populated |

### FR-4: CLI Integration (P1)

| ID | Requirement | Acceptance Criteria |
|----|-------------|---------------------|
| FR-4.1 | `Get-AgentHealth.ps1` displays health in console | Colored output |
| FR-4.2 | Exit codes: 0 (healthy), 1 (warning), 2 (error) | Tests verify exit codes |

---

## Technical Design

### Config.psd1 Changes

```powershell
HealthThresholds = @{
    MemoryUsage = @{ Warning = 70; Error = 90 }
    TaskFailureRate = @{ Warning = 10; Error = 25 }
    SessionDuration = @{ Warning = 120; Error = 240 }
    AgentSpawnFailures = @{ Warning = 3; Error = 10 }
}
```

### Metrics.psm1 Module Structure

```powershell
enum HealthStatus { Healthy; Warning; Error }

function Get-HealthThresholds { }      # Load config with env overrides
function Get-ThresholdStatus { }       # Compare value to thresholds
function Get-ComponentHealth { }       # Per-component health
function Get-OverallHealth { }         # Aggregate health
```

---

## Risks and Mitigations

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Issue #169 delayed | Medium | Medium | Phases 1-3 use placeholder metrics |
| Threshold values inappropriate | Low | Low | Environment variable overrides |
| False positives | Medium | Medium | Add smoothing for volatile metrics |

---

## Blocking Questions

### Question 1: Health History Storage (CRITICAL)

**Question**: Where should health history be persisted?

**Options**:
- A) JSON file in `.agents/metrics/health-history.json` (simple)
- B) SQLite database (complex queries)
- C) Defer to external monitoring

**Impact if unanswered**: Phase 4 blocked

---

## Success Metrics

| Metric | Target |
|--------|--------|
| Health status via CLI | 100% of installations |
| Exit codes match status | 100% accuracy |
| Pester test coverage | 90% or greater |

---

## Dependencies

- #169 (Metrics Collection) - BLOCKS Phase 4

---

<sub>üìã Generated by [AI PRD Generation](https://github.com/rjmurillo/ai-agents) ¬∑ [View Workflow](https://github.com/rjmurillo/ai-agents/actions/runs/20393552905)</sub>



### Comment by @github-actions on 12/20/2025 11:17:08

<!-- AI-ISSUE-TRIAGE -->

## AI Triage Summary

> [!NOTE]
> This issue has been automatically triaged by AI agents

<details>
<summary>What is AI Triage?</summary>

This issue was analyzed by AI agents:

- **Analyst Agent**: Categorizes the issue and suggests appropriate labels
- **Roadmap Agent**: Aligns the issue with project milestones and priorities
- **Explainer Agent** (if escalated): Generates comprehensive PRD

</details>

### Triage Results

| Property | Value |
|:---------|:------|
| **Category** | `enhancement` |
| **Labels** | enhancement area-infrastructure |
|  **Priority** | `P1` |
| **Milestone** | v1.2 |
| **PRD Escalation** | Generated (see below) |

<details>
<summary>Categorization Analysis</summary>

```json
```json
{
  "labels": ["enhancement", "area-infrastructure"],
  "category": "enhancement",
  "confidence": 0.92,
  "reasoning": "Issue proposes new health status computation feature with threshold-based monitoring and optimization recommendations"
}
```

```

</details>

<details>
<summary>Roadmap Alignment</summary>

```json
```json
{
  "milestone": "v1.2",
  "priority": "P1",
  "epic_alignment": "",
  "confidence": 0.70,
  "reasoning": "Feature request for health status computation depends on Issue #169 (metrics collection), placing it after v1.1 maintainability work",
  "escalate_to_prd": true,
  "escalation_criteria": ["feature_request", "research_required", "external_dependency", "multi_phase_work"],
  "complexity_score": 9
}
```

```

</details>

---

<sub>Powered by [AI Issue Triage](https://github.com/rjmurillo/ai-agents) - [View Workflow](https://github.com/rjmurillo/ai-agents/actions/runs/20393552905)</sub>


