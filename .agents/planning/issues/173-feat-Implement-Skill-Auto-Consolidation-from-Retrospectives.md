---
number: 173
title: "feat: Implement Skill Auto-Consolidation from Retrospectives"
state: OPEN
created_at: 12/20/2025 11:09:42
author: rjmurillo-bot
labels: ["enhancement", "priority:P2"]
assignees: []
milestone: null
url: https://github.com/rjmurillo/ai-agents/issues/173
---

# feat: Implement Skill Auto-Consolidation from Retrospectives

## Summary

Implement automatic skill consolidation that extracts and stores reusable patterns from successful task executions.

## Background

Claude-flow's AdvancedMemorySystem automatically consolidates patterns that meet criteria: minimum 3 uses, 70%+ success rate, within 7-day window. This creates a self-improving system without manual intervention.

## Current State

- Retrospective agent manually extracts learnings
- Skillbook agent manually stores skills
- No automatic pattern detection
- No success rate tracking

## Proposed Solution

1. **Pattern Detection**:
   - Track task execution outcomes (success/failure)
   - Identify recurring solution patterns
   - Calculate success rates per pattern
   
2. **Auto-Consolidation Criteria**:
   - `minUses`: Minimum usage count (default: 3)
   - `minSuccessRate`: Minimum success rate (default: 70%)
   - `lookbackDays`: Time window for analysis (default: 7)
   
3. **Skill Generation**:
   - Extract pattern context and approach
   - Generate SKILL.md with YAML frontmatter
   - Store in .agents/skills/ or .serena/memories/
   - Link to source tasks for traceability
   
4. **Deduplication**:
   - Search existing skills before creating
   - Merge similar patterns
   - Update usage counts and success rates

## Benefits

- Self-improving agent system
- Reduced manual overhead for skill management
- Higher quality skills (evidence-based)
- Faster learning from successful patterns

## Implementation Notes

- Integrate with task metrics collection
- Add consolidation job to session-end hook
- Preserve atomicity scoring (70%+ threshold)
- Support manual override for edge cases

## Reference

See claude-flow's Skills System and neural learning (wiki page 9.4).

## Analysis Document

`.agents/analysis/claude-flow-architecture-analysis.md`

---

## Comments

### Comment by @coderabbitai on 12/20/2025 11:11:29

<!-- This is an auto-generated issue plan by CodeRabbit -->


### üìù CodeRabbit Plan Mode
Generate an implementation plan and prompts that you can use with your favorite coding agent.

- [ ] <!-- {"checkboxId": "8d4f2b9c-3e1a-4f7c-a9b2-d5e8f1c4a7b9"} --> Create Plan

<details>
<summary>Examples</summary>

- [Example 1](https://github.com/coderabbitai/git-worktree-runner/issues/29#issuecomment-3589134556)
- [Example 2](https://github.com/coderabbitai/git-worktree-runner/issues/12#issuecomment-3606665167)

</details>

---

<details>
<summary><b>üîó Similar Issues</b></summary>

**Related Issues**
- https://github.com/rjmurillo/ai-agents/issues/126
- https://github.com/rjmurillo/ai-agents/issues/85
- https://github.com/rjmurillo/ai-agents/issues/170
- https://github.com/rjmurillo/ai-agents/issues/169
- https://github.com/rjmurillo/ai-agents/issues/167
- https://github.com/rjmurillo/ai-agents/issues/168
</details>
<details>
<summary><b>üîó Related PRs</b></summary>

rjmurillo/vs-code-agents#1 - feat: Add customized multi-agent system for VS Code and Claude Code [merged]
rjmurillo/Qwiq#108 - chore: modernization wave 2-4 progress with TFM expansion and test infrastructure [merged]
rjmurillo/vs-code-agents#11 - feat: achieve Claude agent parity with VS Code agents [merged]
rjmurillo/Qwiq#118 - feat(build): integrate DotNet.ReproducibleBuilds for deterministic builds [merged]
</details>
<details>
<summary><b>üë§ Suggested Assignees</b></summary>

- [rjmurillo-bot](https://github.com/rjmurillo-bot)
- [rjmurillo](https://github.com/rjmurillo)
</details>


---
<details>
<summary> üß™ Issue enrichment is currently in open beta.</summary>


You can configure auto-planning by selecting labels in the issue_enrichment configuration.

To disable automatic issue enrichment, add the following to your `.coderabbit.yaml`:
```yaml
issue_enrichment:
  auto_enrich:
    enabled: false
```
</details>

üí¨ Have feedback or questions? Drop into our [discord](https://discord.gg/coderabbit) or [schedule a call](https://calendly.com/parth-coderabbit/issues-feedback)!

### Comment by @github-actions on 12/20/2025 11:14:03

<!-- AI-PRD-GENERATION -->

## üìã Product Requirements Document

> [!IMPORTANT]
> This PRD was automatically generated based on issue triage escalation.
> **Complexity Score**: 9/12 ()
> **Escalation Criteria**: feature_request, research_required, multi_phase_work, architectural_impact

<details>
<summary>üìñ About this PRD</summary>

This PRD was generated by the **Explainer Agent** after the issue was flagged
for detailed analysis. The document is designed to be self-contained - it can
be passed to a separate AI agent instance for implementation without additional
context.

**PRD Depth Levels**:
- **Standard** (4-6): Brief analysis, clear requirements
- **Detailed** (7-9): Research section, blocking questions
- **Comprehensive** (10-12): Phased implementation, risk analysis

</details>

---

Let me gather more context by reading the analysis document and exploring the existing skills structure.

Let me explore the existing skills structure, retrospective agent, and skillbook agent to understand the current implementation.

Now let me examine the retrospective and skillbook agents to understand the current skill extraction and storage mechanisms.

Let me look at an example skill file structure and check if there's any existing implementation of task tracking or metrics collection.

Now I have sufficient context. Let me create a comprehensive PRD for the Skill Auto-Consolidation feature.

The file system is read-only in this environment. I will output the PRD directly.

---

# PRD: Skill Auto-Consolidation from Retrospectives

## Executive Summary

Implement automatic skill consolidation that extracts and stores reusable patterns from successful task executions without manual intervention. Currently, retrospective agent manually extracts learnings and skillbook agent manually stores skills. This creates a gap where successful patterns are lost if not explicitly processed.

| Scope | Status | Blocker |
|-------|--------|---------|
| Pattern detection from task outcomes | :yellow_circle: PARTIAL | Task metrics collection not implemented |
| Auto-consolidation with thresholds | :yellow_circle: PARTIAL | No success rate tracking exists |
| Skill generation with YAML frontmatter | :green_circle: READY | Skill format is well-defined |
| Deduplication before storage | :green_circle: READY | skillbook agent has dedup logic |
| Session-end hook integration | :yellow_circle: PARTIAL | SESSION-PROTOCOL.md exists but no automation hook |

**Verdict**: PARTIAL - Core skill storage exists but pattern detection and metrics tracking require new implementation.

---

## Problem Statement

### Current State

| Component | Status | Description |
|-----------|--------|-------------|
| Retrospective Agent | Manual | Extracts learnings via Five Whys, requires explicit invocation |
| Skillbook Agent | Manual | Stores skills, requires retrospective handoff |
| Pattern Detection | None | No automated tracking of recurring solution patterns |
| Success Rate Tracking | None | No persistence of task outcomes (success/failure) |
| Skill Storage | Exists | `.agents/skills/` and `.serena/memories/` contain skills |

### Gap Analysis

1. **No Automatic Triggering**: Retrospective agent runs only when explicitly invoked
2. **No Metrics Collection**: Task outcomes are not tracked systematically
3. **No Pattern Recognition**: No system identifies recurring successful patterns as skill-worthy
4. **Manual Deduplication**: Skillbook agent checks for duplicates only when manually invoked
5. **Lost Learnings**: Successful patterns in session logs are not automatically extracted

### User Impact

| User Type | Impact |
|-----------|--------|
| Developers | Repeat discoveries across sessions, losing productivity |
| Agent System | No institutional memory, makes same mistakes |
| Project | Skill quality degrades as high-value learnings get lost |

---

## Research Findings

### Primary Sources

**Claude-flow Skills System (Reference)**:
> "AdvancedMemorySystem automatically consolidates patterns that meet criteria: minimum 3 uses, 70%+ success rate, within 7-day window."

Source: Issue body, wiki page 9.4 reference. Confidence: LIKELY

### Secondary Sources (CONFIRMED from codebase inspection)

1. **Atomicity Scoring**: 70% threshold defined in `src/claude/retrospective.md` and `src/claude/skillbook.md`
2. **Skill Format**: Well-defined in `.agents/skills/README.md`
3. **Memory Protocol**: cloudmcp-manager tools available for entity operations
4. **Session Protocol**: `.agents/SESSION-PROTOCOL.md` defines session end requirements

### Empirical Data

| Observation | Evidence |
|-------------|----------|
| 89 memory files in `.serena/memories/` | Rich skill content, created manually |
| 6 skill files in `.agents/skills/` | Category-based organization established |
| 36 session logs in `.agents/sessions/` | High session volume, low skill extraction ratio |
| Retrospective handoff format | Structured format exists for downstream processing |

---

## Proposed Solution

### Phase 1: Metrics Collection Infrastructure (Effort: M, 4-8 hours)

**Status**: DEPENDS on storage format decision

| Task | Description |
|------|-------------|
| 1.1 | Define TaskExecution schema (task_id, pattern_signature, outcome, timestamp, context) |
| 1.2 | Create Record-TaskOutcome.ps1 script |
| 1.3 | Define pattern signature extraction algorithm |
| 1.4 | Create metrics store (.agents/metrics/task-outcomes.json) |
| 1.5 | Add Pester tests |

### Phase 2: Consolidation Engine (Effort: L, 8-16 hours)

**Status**: DEPENDS on Phase 1

| Task | Description |
|------|-------------|
| 2.1 | Create Invoke-SkillConsolidation.ps1 with configurable thresholds |
| 2.2 | Implement pattern aggregation (group by pattern_signature) |
| 2.3 | Implement success rate calculation |
| 2.4 | Implement lookback window filtering (default: 7 days) |
| 2.5 | Create candidate ranking |
| 2.6 | Add Pester tests |

### Phase 3: Skill Generation (Effort: M, 4-8 hours)

**Status**: READY

| Task | Description |
|------|-------------|
| 3.1 | Create SKILL.md template with YAML frontmatter |
| 3.2 | Implement skill file generation |
| 3.3 | Implement deduplication check (70% similarity threshold) |
| 3.4 | Implement merge logic for similar patterns |
| 3.5 | Create source task traceability links |
| 3.6 | Add Pester tests |

### Phase 4: Integration (Effort: S, 2-4 hours)

**Status**: DEPENDS on Phases 1-3

| Task | Description |
|------|-------------|
| 4.1 | Add consolidation to session-end hook in SESSION-PROTOCOL.md |
| 4.2 | Update orchestrator to invoke consolidation after retrospective |
| 4.3 | Add manual override option |
| 4.4 | Create monitoring/logging |

---

## Functional Requirements

### FR-1: Task Outcome Tracking (P0)

| ID | Requirement | Acceptance Criteria |
|----|-------------|---------------------|
| FR-1.1 | Record task outcomes (SUCCESS, PARTIAL, FAILURE) | Outcome persisted within 100ms |
| FR-1.2 | Capture pattern signature for each task | Signature normalizes task type + approach |
| FR-1.3 | Timestamp each outcome record | ISO 8601 UTC format |
| FR-1.4 | Persist outcomes across sessions | Retrievable after restart |

### FR-2: Pattern Detection (P0)

| ID | Requirement | Acceptance Criteria |
|----|-------------|---------------------|
| FR-2.1 | Aggregate outcomes by pattern signature | Identical signatures grouped |
| FR-2.2 | Calculate success rate per pattern | Rate = SUCCESS / total * 100 |
| FR-2.3 | Filter by lookback window | Default 7 days, configurable |
| FR-2.4 | Identify patterns meeting criteria | minUses >= 3 AND successRate >= 70% |

### FR-3: Skill Generation (P1)

| ID | Requirement | Acceptance Criteria |
|----|-------------|---------------------|
| FR-3.1 | Generate SKILL.md with YAML frontmatter | Valid YAML, required fields present |
| FR-3.2 | Calculate atomicity score | Score 0-100% per formula |
| FR-3.3 | Link to source tasks | Task IDs in metadata |
| FR-3.4 | Store in designated directories | `.agents/skills/` or `.serena/memories/` |

### FR-4: Deduplication (P1)

| ID | Requirement | Acceptance Criteria |
|----|-------------|---------------------|
| FR-4.1 | Search existing skills before creation | Top 5 similar returned |
| FR-4.2 | Merge patterns with > 70% similarity | Existing updated, not duplicated |
| FR-4.3 | Update usage counts on merge | Count incremented |
| FR-4.4 | Preserve higher atomicity on merge | Max(existing, new) retained |

---

## Technical Design

### Skill File Format

```yaml
---
skill_id: Skill-[Category]-[NNN]
statement: "Atomic strategy statement (max 15 words)"
context: "When this skill applies"
atomicity: 92
success_rate: 85
usage_count: 7
created: "2025-12-20"
auto_generated: true
---
# Skill: [Title]
## Pattern
[Description]
## Source Tasks
- [Task references]
```

### Configuration

```powershell
param(
    [int]$MinUses = 3,
    [int]$MinSuccessRate = 70,
    [int]$LookbackDays = 7,
    [switch]$DryRun
)
```

---

## Risks and Mitigations

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Pattern signature collisions | Medium | Medium | Include agent type and task type in signature |
| Low-quality auto-generated skills | Medium | High | Enforce 70% atomicity threshold; manual review for first 10 |
| Metrics file corruption | Low | High | Validate JSON on load; atomic file operations |
| Performance at session end | Low | Medium | Time-box consolidation to 30s |

---

## Success Metrics

| Metric | Target |
|--------|--------|
| Skills auto-generated per week | 3-5 with atomicity >= 80% |
| Skill reuse rate | 50% cited within 30 days |
| Pattern detection accuracy | 90% of high-success patterns identified |
| Deduplication effectiveness | < 5% duplicates created |

---

## Blocking Questions

### Question 1: Metrics Storage Format (CRITICAL)

**Question**: JSON file or cloudmcp-manager memory entities?

**Trade-offs**:
- JSON: Simple, works offline, custom query logic
- Memory entities: Integrated, richer querying, depends on MCP

**Impact if unanswered**: Cannot implement Phase 1

### Question 2: Pattern Signature Granularity (CRITICAL)

**Question**: What granularity for pattern matching?

**Proposal**: Start with task_type + top 3 normalized keywords. Evaluate after 30 days.

**Impact if unanswered**: High false positive/negative rate

---

## Open Questions (Non-Blocking)

1. Mark auto-generated skills with `auto_generated: true`? (Hypothesis: Yes)
2. Run consolidation on every session? (Hypothesis: Yes, with < 5s overhead)
3. Human approval for first 10 auto-generated skills? (Hypothesis: Yes)

---

<sub>üìã Generated by [AI PRD Generation](https://github.com/rjmurillo/ai-agents) ¬∑ [View Workflow](https://github.com/rjmurillo/ai-agents/actions/runs/20393513065)</sub>



### Comment by @github-actions on 12/20/2025 11:14:05

<!-- AI-ISSUE-TRIAGE -->

## AI Triage Summary

> [!NOTE]
> This issue has been automatically triaged by AI agents

<details>
<summary>What is AI Triage?</summary>

This issue was analyzed by AI agents:

- **Analyst Agent**: Categorizes the issue and suggests appropriate labels
- **Roadmap Agent**: Aligns the issue with project milestones and priorities
- **Explainer Agent** (if escalated): Generates comprehensive PRD

</details>

### Triage Results

| Property | Value |
|:---------|:------|
| **Category** | `enhancement` |
| **Labels** | enhancement agent-retrospective agent-skillbook agent-memory |
|  **Priority** | `P1` |
| **Milestone** | v1.1 |
| **PRD Escalation** | Generated (see below) |

<details>
<summary>Categorization Analysis</summary>

```json
```json
{
  "labels": ["enhancement", "agent-retrospective", "agent-skillbook", "agent-memory"],
  "category": "enhancement",
  "confidence": 0.92,
  "reasoning": "Feature request for automatic skill extraction from retrospectives, involving retrospective agent for learning extraction, skillbook agent for skill storage, and memory agent for pattern tracking"
}
```

```

</details>

<details>
<summary>Roadmap Alignment</summary>

```json
```json
{
  "milestone": "v1.1",
  "priority": "P1",
  "epic_alignment": "Skill Management System",
  "confidence": 0.85,
  "reasoning": "Aligns directly with v1.0 P2 'Skill Management System' epic (currently Partial status); extends skillbook agent with automatic pattern extraction.",
  "escalate_to_prd": true,
  "escalation_criteria": ["feature_request", "research_required", "multi_phase_work", "architectural_impact"],
  "complexity_score": 9
}
```

```

</details>

---

<sub>Powered by [AI Issue Triage](https://github.com/rjmurillo/ai-agents) - [View Workflow](https://github.com/rjmurillo/ai-agents/actions/runs/20393513065)</sub>


