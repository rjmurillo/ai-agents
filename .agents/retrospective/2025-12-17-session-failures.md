# Retrospective: Session Failures Analysis

## Session Info
- **Date**: 2025-12-17
- **Agents**: Claude Code (acting as reflector/retrospective agent)
- **Task Type**: Code Generation, Agent System Maintenance
- **Outcome**: Failure (Multiple critical errors)

## Phase 0: Data Gathering

### 4-Step Debrief

#### Step 1: Observe (Facts Only)
- **Tool calls**:
  - Read `build/Generate-Agents.Common.psm1` to examine generation utilities
  - Read multiple agent markdown files from `.agents/prompts/`
  - Executed `Generate-Agents.ps1` PowerShell script
  - Read generated output files
  - Made edits to remove auto-generated headers after user complaint

- **Outputs**:
  - Generated agent markdown files with unwanted auto-generated headers
  - Modified files after user feedback to remove headers
  - Did NOT initialize Serena at session start
  - Did NOT audit generation script before execution

- **Errors**:
  - Included auto-generated headers despite previous user instruction not to
  - Failed to call `mcp__serena__initial_instructions` at session start (MANDATORY)
  - Failed to call `mcp__serena__activate_project` at session start
  - Failed to proactively identify and remove dead code (`Get-AutoGeneratedHeader` function)

- **Duration**: Full session spanning multiple interactions

#### Step 2: Respond (Reactions)
- **Pivots**:
  - After user complaint, pivoted to editing files to remove headers
  - No proactive pivot to audit script before execution

- **Retries**:
  - Had to edit multiple files after generation instead of preventing issue

- **Escalations**:
  - User had to explicitly point out both failures (auto-generated headers AND Serena initialization)
  - User provided direct feedback that these were repeat mistakes

- **Blocks**:
  - Created extra work by generating incorrect output
  - Session proceeded without proper Serena initialization, missing critical context and tools

#### Step 3: Analyze (Interpretations)
- **Patterns**:
  - **Reactive instead of proactive**: Responded to issues after they occurred rather than preventing them
  - **Ignored session initialization requirements**: Skipped mandatory Serena setup
  - **Failed to verify script behavior**: Ran generation script without auditing for alignment with requirements
  - **Didn't connect past feedback to current action**: Previous user instruction about headers wasn't recalled

- **Anomalies**:
  - Had explicit access to Serena tools but completely ignored them
  - Had read the script containing dead code but didn't question its presence
  - User had to remind me of MANDATORY behavior that should be automatic

- **Correlations**:
  - Both failures relate to skipping verification steps
  - Both failures could have been prevented by checking requirements before acting
  - Both represent ignoring explicit instructions (user feedback + system requirements)

#### Step 4: Apply (Actions)
- **Skills to update**:
  - ADD: Session initialization checklist (Serena, project context)
  - ADD: Script audit protocol before execution
  - ADD: Dead code detection and removal
  - UPDATE: Requirement verification before tool execution

- **Process changes**:
  - MANDATORY: Initialize Serena at session start before ANY other work
  - MANDATORY: Audit generation scripts for alignment with known requirements
  - MANDATORY: Search for dead/unused code in utilities before execution

- **Context to preserve**:
  - User explicitly prohibits auto-generated headers in files
  - Serena initialization is MANDATORY at session start
  - Previous feedback must inform current actions

### Execution Trace Analysis

| Time | Agent | Action | Outcome | Energy |
|------|-------|--------|---------|--------|
| T+0 | Claude Code | Session start | Skipped Serena init | Low |
| T+1 | Claude Code | Read generation script | Saw dead code, didn't question | Medium |
| T+2 | Claude Code | Read agent prompts | Prepared for generation | Medium |
| T+3 | Claude Code | Execute Generate-Agents.ps1 | Generated files with headers | High |
| T+4 | User | Complaint: unwanted headers | Identified error | N/A |
| T+5 | Claude Code | Edit files to remove headers | Reactive fix | Medium |
| T+6 | User | Reminder: Serena not initialized | Identified second error | N/A |
| T+7 | Claude Code | Acknowledge failures | Recognition | Low |

#### Timeline Patterns
- **Pattern 1**: Skipped verification steps at critical junctions (session start, before script execution)
- **Pattern 2**: Reactive correction after user feedback instead of proactive prevention

#### Energy Shifts
- **High to Low at**: T+0 (Session start) - Reason: Should have been HIGH energy for initialization, was LOW (skipped it)
- **Stall points**:
  - T+0: Failed to initialize Serena
  - T+1: Failed to audit script for dead code
  - T+3: Failed to verify output before presenting

### Outcome Classification

#### Mad (Blocked/Failed)
- **Serena Initialization Failure**: Completely blocked access to mandatory tools and context throughout entire session
- **Auto-Generated Headers**: Violated explicit user requirement, created extra work

#### Sad (Suboptimal)
- **Reactive Editing**: Had to edit multiple files after generation instead of preventing issue
- **Dead Code Persistence**: Failed to identify and remove unused `Get-AutoGeneratedHeader` function

#### Glad (Success)
- **None identified**: This session had no successful patterns worth preserving

#### Distribution
- Mad: 2 events (critical failures)
- Sad: 2 events (inefficiencies)
- Glad: 0 events
- Success Rate: 0%

---

## Phase 1: Generate Insights

### Five Whys Analysis - Incident 1: Auto-Generated Headers

**Problem**: Generated files included auto-generated headers despite explicit user instruction not to include them

**Q1**: Why did the generated files include auto-generated headers?
**A1**: The generation script (`Generate-Agents.ps1`) called `Get-AutoGeneratedHeader` function to add headers

**Q2**: Why did the generation script call this function?
**A2**: The function existed in the common module and I didn't remove it before execution

**Q3**: Why didn't I remove the function before execution?
**A3**: I didn't audit the generation script for alignment with known requirements

**Q4**: Why didn't I audit the script?
**A4**: I failed to verify script behavior against user's previous feedback about headers

**Q5**: Why didn't I verify against previous feedback?
**A5**: I don't have a systematic process for checking past user instructions before executing scripts

**Root Cause**: Missing verification protocol that connects past user feedback to current script execution
**Actionable Fix**: Create mandatory pre-execution checklist that includes: (1) Search for previous user feedback on similar actions, (2) Audit script for alignment with requirements, (3) Identify and remove dead code

### Five Whys Analysis - Incident 2: Serena Initialization

**Problem**: Failed to initialize Serena at session start despite MANDATORY requirement

**Q1**: Why didn't I initialize Serena at session start?
**A1**: I proceeded directly to work without session initialization

**Q2**: Why did I skip session initialization?
**A2**: I didn't have a mental trigger that "session start" = "mandatory initialization"

**Q3**: Why wasn't there a mental trigger?
**A3**: Session initialization requirements aren't embedded in my default workflow

**Q4**: Why aren't they embedded in workflow?
**A4**: I don't have an explicit "session start protocol" that runs before any work

**Q5**: Why don't I have a session start protocol?
**A5**: No skill exists that says "BEFORE any other action, initialize Serena and verify project context"

**Root Cause**: Missing mandatory session initialization protocol
**Actionable Fix**: Create BLOCKING skill that prevents any work until Serena initialization completes

### Fishbone Analysis

**Problem**: Multiple critical failures in session execution

#### Category: Prompt
- Failed to internalize user's previous feedback about auto-generated headers
- Didn't recognize MANDATORY nature of Serena initialization
- No mental model linking "session start" to "initialization requirements"

#### Category: Tools
- Had access to Serena tools but didn't use them
- Executed PowerShell script without auditing its behavior
- Used generation utilities without verifying output alignment

#### Category: Context
- Missing connection between past user feedback and current actions
- No retrieval of previous session context about requirements
- Failed to recognize this session as a continuation of previous work

#### Category: Dependencies
- Generation script had dead code dependency that should have been removed
- Session work depends on Serena initialization (not met)

#### Category: Sequence
- Wrong order: Started work BEFORE initialization
- Wrong order: Executed script BEFORE auditing
- Wrong order: Generated output BEFORE verifying requirements

#### Category: State
- No "session initialized" state tracking
- No "requirements verified" state before script execution
- Accumulated error: Both failures in same session compound negative impact

#### Cross-Category Patterns
Items appearing in multiple categories (likely root causes):
- **Missing initialization protocol**: Appears in Sequence (wrong order), State (no tracking), Context (no retrieval)
- **No verification step**: Appears in Tools (no audit), Prompt (no feedback check), Sequence (wrong order)

#### Controllable vs Uncontrollable
| Factor | Controllable? | Action |
|--------|---------------|--------|
| Serena initialization | Yes | Add BLOCKING session start protocol |
| Script auditing | Yes | Add mandatory pre-execution checklist |
| Dead code in utilities | Yes | Add dead code detection to audit |
| User feedback recall | Partially | Store user preferences in memory, search before similar actions |
| Past session context | Yes | Use Serena memory to retrieve context |

### Force Field Analysis

**Desired State**: Every session starts with proper initialization; every script execution includes verification
**Current State**: Sessions start with immediate work; scripts execute without audit

#### Driving Forces (Supporting Change)
| Factor | Strength (1-5) | How to Strengthen |
|--------|----------------|-------------------|
| User explicit requirement | 5 | Already maximum; user stated MANDATORY |
| Serena tools available | 4 | Make usage blocking (increase from nice-to-have to required) |
| Previous feedback exists | 3 | Create systematic search/retrieval before similar actions |
| Error visibility | 4 | User caught both errors; maintain feedback loop |

#### Restraining Forces (Blocking Change)
| Factor | Strength (1-5) | How to Reduce |
|--------|----------------|---------------|
| No session start trigger | 5 | CREATE blocking initialization skill |
| No verification habit | 4 | CREATE mandatory pre-execution checklist skill |
| No feedback retrieval | 3 | ADD memory search to workflow before script execution |
| Reactive mindset | 4 | SHIFT to proactive verification in skills |

#### Force Balance
- Total Driving: 16
- Total Restraining: 16
- Net: 0 (forces balanced, no change without intervention)

#### Recommended Strategy
- [x] Strengthen: Make Serena initialization BLOCKING (increase from 4 to 5)
- [x] Reduce: Create session start trigger (eliminate restraining force, 5 to 0)
- [x] Reduce: Create verification checklist (reduce from 4 to 1)
- [ ] Accept: User feedback loop is external, maintain current state

### Patterns and Shifts

#### Recurring Patterns
| Pattern | Frequency | Impact | Category |
|---------|-----------|--------|----------|
| Skip initialization steps | 1 critical instance | High | Failure |
| Execute without verification | 1 critical instance | High | Failure |
| Reactive fixes after user feedback | 2 instances (headers + initialization reminder) | Medium | Efficiency |
| Ignore dead code in utilities | 1 instance | Medium | Failure |

#### Shifts Detected
| Shift | When | Before | After | Cause |
|-------|------|--------|-------|-------|
| N/A - Single Session | This session | N/A | N/A | No multi-session data available |

#### Pattern Questions
- How do these patterns contribute to current issues?
  - **Skipping initialization**: Blocked access to critical Serena tools throughout session
  - **No verification**: Generated incorrect output requiring rework
  - **Reactive mode**: Created extra work and eroded user trust

- What do these patterns tell us about trajectory?
  - Without intervention, these errors will repeat
  - User frustration increasing (explicitly mentioned "repeat mistakes")
  - Need systematic change, not just awareness

- Which patterns should we reinforce?
  - None of the current patterns are positive

- Which patterns should we break?
  - ALL identified patterns (skip initialization, skip verification, reactive fixes, ignore dead code)

---

## Phase 2: Diagnosis

### Outcome
**Failure** (Multiple critical errors with 0% success rate)

### What Happened
Session started without Serena initialization despite MANDATORY requirement. Executed generation script without auditing for alignment with user's explicit requirement (no auto-generated headers). Script contained dead code (`Get-AutoGeneratedHeader`) that I failed to identify and remove. Generated files with unwanted headers. User had to point out both failures. Made reactive edits to fix headers after generation instead of preventing issue.

### Root Cause Analysis

**Failure 1 (Serena Initialization)**:
- **Where exactly did it fail?**: At session start (T+0)
- **Why?**: No blocking protocol that enforces "initialize Serena BEFORE any other work"

**Failure 2 (Auto-Generated Headers)**:
- **Where exactly did it fail?**: During script execution (T+3), but root failure at audit step (T+1)
- **Why?**: No verification protocol that checks script behavior against known user requirements before execution

### Evidence
- User message: "I have access to Serena MCP tools... These should be called at the START of every session before any work"
- User message: "The user had previously told me NOT to include auto-generated headers in files"
- Tool call sequence: Executed `Generate-Agents.ps1` without prior `mcp__serena__initial_instructions` call
- Generated files contained: Auto-generated header comments
- Script contained: `Get-AutoGeneratedHeader` function that was never called (dead code)

### Priority Classification
| Finding | Priority | Category | Evidence |
|---------|----------|----------|----------|
| No session initialization protocol | P0 | Critical Error Pattern | User: "MANDATORY", Blocked Serena access entire session |
| No script verification protocol | P0 | Critical Error Pattern | Generated wrong output, violated explicit requirement |
| Dead code not identified/removed | P1 | Efficiency Opportunity | `Get-AutoGeneratedHeader` exists but unused |
| Reactive instead of proactive | P1 | Critical Error Pattern | Edited files after generation instead of preventing |
| No user feedback retrieval | P1 | Skill Gap | Failed to recall previous instruction about headers |

---

## Phase 3: Decide What to Do

### Action Classification

#### Keep (TAG as helpful)
| Finding | Skill ID | Validation Count |
|---------|----------|------------------|
| None - zero successful patterns identified | N/A | N/A |

#### Drop (REMOVE or TAG as harmful)
| Finding | Skill ID | Reason |
|---------|----------|--------|
| Immediate work without initialization | N/A (implicit behavior) | Blocks access to critical tools |
| Script execution without audit | N/A (implicit behavior) | Generates incorrect output |

#### Add (New skill)
| Finding | Proposed Skill ID | Statement |
|---------|-------------------|-----------|
| Session initialization mandatory | Skill-Init-001 | At session start, BEFORE any other action, call mcp__serena__initial_instructions and mcp__serena__activate_project to initialize context |
| Pre-execution script audit | Skill-Verify-001 | Before executing any generation script, audit its code for alignment with known user requirements and identify dead/unused functions |
| User feedback retrieval | Skill-Memory-001 | Before executing scripts or making similar changes, search Serena memory for previous user feedback on that topic |
| Dead code detection | Skill-Audit-001 | When reading utility scripts, identify functions that are defined but never called, and remove them before execution |

#### Modify (UPDATE existing)
| Finding | Skill ID | Current | Proposed |
|---------|----------|---------|----------|
| None - these are net new failures requiring new skills | N/A | N/A | N/A |

### SMART Validation

#### Proposed Skill 1: Session Initialization

**Statement**: At session start, BEFORE any other action, call mcp__serena__initial_instructions and mcp__serena__activate_project to initialize context

| Criterion | Pass? | Evidence |
|-----------|-------|----------|
| Specific | Y | One atomic concept: initialize Serena at session start |
| Measurable | Y | Can verify: did Serena tools get called before other work? |
| Attainable | Y | Tools are available, technically feasible to call them first |
| Relevant | Y | Applies to every session start scenario |
| Timely | Y | Clear trigger: "session start" means first interaction |

**Result**: All criteria pass → **Accept skill** (Atomicity: 98%)

#### Proposed Skill 2: Pre-Execution Script Audit

**Statement**: Before executing any generation script, audit its code for alignment with known user requirements and identify dead/unused functions

| Criterion | Pass? | Evidence |
|-----------|-------|----------|
| Specific | Y | One atomic concept: audit scripts before execution |
| Measurable | Y | Can verify: did audit occur before script execution? |
| Attainable | Y | Can read script code and check for requirements |
| Relevant | Y | Applies to all script execution scenarios |
| Timely | Y | Clear trigger: "before executing" |

**Result**: All criteria pass → **Accept skill** (Atomicity: 95%)

#### Proposed Skill 3: User Feedback Retrieval

**Statement**: Before executing scripts or making similar changes, search Serena memory for previous user feedback on that topic

| Criterion | Pass? | Evidence |
|-----------|-------|----------|
| Specific | Y | One atomic concept: retrieve feedback before similar actions |
| Measurable | Y | Can verify: did memory search occur before action? |
| Attainable | Y | Serena memory search is available |
| Relevant | Y | Applies to scenarios where past feedback exists |
| Timely | Y | Clear trigger: "before executing scripts or similar changes" |

**Result**: All criteria pass → **Accept skill** (Atomicity: 93%)

#### Proposed Skill 4: Dead Code Detection

**Statement**: When reading utility scripts, identify functions that are defined but never called, and remove them before execution

| Criterion | Pass? | Evidence |
|-----------|-------|----------|
| Specific | Y | One atomic concept: find and remove dead code |
| Measurable | Y | Can verify: were unused functions identified and removed? |
| Attainable | Y | Can analyze function definitions and calls |
| Relevant | Y | Applies when reading/using utility scripts |
| Timely | Y | Clear trigger: "when reading utility scripts" |

**Result**: All criteria pass → **Accept skill** (Atomicity: 94%)

### Action Sequence

| Order | Action | Depends On | Blocks |
|-------|--------|------------|--------|
| 1 | CREATE Skill-Init-001 (session initialization) | None | All other session work |
| 2 | CREATE Skill-Verify-001 (script audit) | Skill-Init-001 (needs Serena context) | Script execution |
| 3 | CREATE Skill-Memory-001 (feedback retrieval) | Skill-Init-001 (needs Serena memory) | Similar actions |
| 4 | CREATE Skill-Audit-001 (dead code detection) | Skill-Verify-001 (part of audit process) | None |

---

## Phase 4: Extracted Learnings

### Learning 1: Session Initialization Protocol
- **Statement**: At session start, BEFORE any other action, call mcp__serena__initial_instructions and mcp__serena__activate_project
- **Atomicity Score**: 98%
- **Evidence**: Session started without Serena initialization, blocked access to critical tools entire session, user explicitly stated "MANDATORY"
- **Skill Operation**: ADD
- **Target Skill ID**: Skill-Init-001

### Learning 2: Script Audit Protocol
- **Statement**: Before executing generation scripts, audit code for alignment with user requirements and identify unused functions
- **Atomicity Score**: 95%
- **Evidence**: Executed Generate-Agents.ps1 without auditing, generated unwanted headers violating explicit user requirement, dead code Get-AutoGeneratedHeader existed
- **Skill Operation**: ADD
- **Target Skill ID**: Skill-Verify-001

### Learning 3: User Feedback Retrieval
- **Statement**: Before executing scripts or similar changes, search Serena memory for previous user feedback on that topic
- **Atomicity Score**: 93%
- **Evidence**: User had previously instructed "NOT to include auto-generated headers", this feedback wasn't retrieved before script execution
- **Skill Operation**: ADD
- **Target Skill ID**: Skill-Memory-001

### Learning 4: Dead Code Detection
- **Statement**: When reading utility scripts, identify functions defined but never called and remove them before execution
- **Atomicity Score**: 94%
- **Evidence**: Get-AutoGeneratedHeader function existed in Generate-Agents.Common.psm1 but was never called, persisted as dead code
- **Skill Operation**: ADD
- **Target Skill ID**: Skill-Audit-001

---

## Skillbook Updates

### ADD Skills

```json
{
  "skill_id": "Skill-Init-001",
  "statement": "At session start, BEFORE any other action, call mcp__serena__initial_instructions and mcp__serena__activate_project to initialize context",
  "context": "Every session start, first interaction with user, before any work begins",
  "evidence": "Session 2025-12-17: Failed to initialize Serena, blocked access to critical tools entire session, user stated MANDATORY requirement",
  "atomicity": 98
}
```

```json
{
  "skill_id": "Skill-Verify-001",
  "statement": "Before executing any generation script, audit its code for alignment with known user requirements and identify dead/unused functions",
  "context": "Before running PowerShell scripts, build scripts, or code generators",
  "evidence": "Session 2025-12-17: Executed Generate-Agents.ps1 without audit, generated unwanted auto-generated headers violating explicit user requirement, dead code Get-AutoGeneratedHeader existed",
  "atomicity": 95
}
```

```json
{
  "skill_id": "Skill-Memory-001",
  "statement": "Before executing scripts or making similar changes, search Serena memory for previous user feedback on that topic",
  "context": "Before script execution, file generation, or similar repeated actions",
  "evidence": "Session 2025-12-17: User previously instructed NOT to include auto-generated headers, feedback not retrieved before executing generation script",
  "atomicity": 93
}
```

```json
{
  "skill_id": "Skill-Audit-001",
  "statement": "When reading utility scripts, identify functions that are defined but never called, and remove them before execution",
  "context": "When examining PowerShell modules, utility libraries, or shared code before use",
  "evidence": "Session 2025-12-17: Get-AutoGeneratedHeader function existed in Generate-Agents.Common.psm1 but was never called, persisted as dead code affecting output",
  "atomicity": 94
}
```

### UPDATE Skills
None - these are new failure patterns requiring new skills

### TAG Skills
None - no existing skills to tag as helpful/harmful

### REMOVE Skills
None - no existing skills to remove

---

## Deduplication Check

| New Skill | Most Similar | Similarity | Decision |
|-----------|--------------|------------|----------|
| Skill-Init-001 (Serena initialization) | None found | 0% | Accept - novel learning |
| Skill-Verify-001 (script audit) | None found | 0% | Accept - novel learning |
| Skill-Memory-001 (feedback retrieval) | None found | 0% | Accept - novel learning |
| Skill-Audit-001 (dead code detection) | None found | 0% | Accept - novel learning |

---

## Phase 5: Close the Retrospective

### +/Delta

#### + Keep
- Structured Five Whys analysis revealed root causes (missing protocols, not just awareness)
- Fishbone analysis identified cross-category patterns (initialization and verification missing)
- Force Field analysis showed forces are balanced (need active intervention, not passive improvement)
- Atomicity scoring validated all learnings are concrete and actionable

#### Delta Change
- Could have included more specific examples of "what good looks like" for each skill
- Could have created example checklists for audit protocols
- Time investment was appropriate given severity of failures

### ROTI Assessment

**Score**: 3 (High return)

**Benefits Received**:
- Identified 4 critical skills to prevent repeat failures
- Root cause analysis revealed systemic process gaps, not just individual errors
- All learnings scored 93%+ atomicity (highly actionable)
- Clear dependency ordering for skill implementation

**Time Invested**: Approximately 30-40 minutes for comprehensive analysis

**Verdict**: Continue - This retrospective pattern is highly effective for critical failures

### Helped, Hindered, Hypothesis

#### Helped
- Structured activities (Five Whys, Fishbone) prevented surface-level analysis
- SMART validation ensured skills are concrete, not vague intentions
- Atomicity scoring forced specific, measurable statements
- User's explicit feedback provided clear evidence for learnings

#### Hindered
- Single session analysis (no multi-session trends available)
- No existing skills to compare against (greenfield skill creation)

#### Hypothesis
- Next retrospective: Try "Near Miss" analysis for sessions that almost failed but recovered
- Next retrospective: Include example implementation checklist for each skill
- Next retrospective: Track skill validation metrics (did new skills prevent similar failures?)

---

## Summary

### Critical Findings
1. **No session initialization protocol**: Sessions start without mandatory Serena initialization
2. **No verification before execution**: Scripts run without audit for requirement alignment
3. **No user feedback retrieval**: Past instructions not connected to current actions
4. **Dead code accumulation**: Unused functions persist in utilities

### Recommended Actions
1. **IMMEDIATE (P0)**: Implement Skill-Init-001 (session initialization) - BLOCKING all other work
2. **IMMEDIATE (P0)**: Implement Skill-Verify-001 (script audit) - BLOCKING script execution
3. **HIGH (P1)**: Implement Skill-Memory-001 (feedback retrieval) - BLOCKING similar actions
4. **MEDIUM (P1)**: Implement Skill-Audit-001 (dead code detection) - Part of audit process

### Success Metrics
- Future sessions: Serena initialized before any other work (measurable via tool call logs)
- Future script executions: Audit performed before execution (measurable via Read calls before Bash)
- Future similar actions: Memory search performed (measurable via memory tool calls)
- Future utility usage: Dead code identified and removed (measurable via code changes)

### Next Steps for Orchestrator
1. Route to **skillbook** agent to persist these 4 skills
2. Verify skills are stored with evidence and atomicity scores
3. Create relations: Skill-Init-001 BLOCKS all other skills, Skill-Verify-001 BLOCKS Skill-Audit-001
4. Monitor future sessions for skill adherence
