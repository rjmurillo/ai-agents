# Orphan Detection Report Format

> **Version**: 1.0.0
> **Created**: 2025-12-31
> **Related**: [traceability-schema.md](traceability-schema.md)

## Overview

This document defines the standard format for orphan detection reports generated by `Validate-Traceability.ps1`. The format is optimized for both human review and machine parsing.

## Report Generation

Generate a report using:

```powershell
pwsh scripts/Validate-Traceability.ps1 -Format markdown > orphan-report.md
```

## Report Structure

### Header

```markdown
# Traceability Validation Report

**Generated**: YYYY-MM-DD HH:MM:SS
**Specs Path**: .agents/specs
**Validation Mode**: [Standard | Strict]
```

### Summary Table

```markdown
## Summary

| Metric | Count |
|--------|-------|
| Requirements | N |
| Designs | N |
| Tasks | N |
| Valid Chains | N |
| Errors | N |
| Warnings | N |
```

### Errors Section

Errors are BLOCKING violations that must be fixed:

```markdown
## Errors

### Broken References

| Source | Invalid Reference | Fix |
|--------|-------------------|-----|
| TASK-001 | DESIGN-999 | Create DESIGN-999 or update TASK-001 |

### Untraced Tasks

| Task ID | File | Fix |
|---------|------|-----|
| TASK-005 | .agents/specs/tasks/TASK-005-orphan.md | Add `related: [DESIGN-NNN]` to front matter |
```

### Warnings Section

Warnings are non-blocking but indicate spec hygiene issues:

```markdown
## Warnings

### Orphaned Requirements

| REQ ID | File | Impact |
|--------|------|--------|
| REQ-003 | .agents/specs/requirements/REQ-003-unused.md | No design implements this requirement |

### Orphaned Designs

| DESIGN ID | File | Impact |
|-----------|------|--------|
| DESIGN-002 | .agents/specs/design/DESIGN-002-unused.md | No tasks implement this design |
```

### Info Section

Informational findings about status consistency:

```markdown
## Info

### Status Inconsistencies

| Task | Task Status | Design | Design Status | Note |
|------|-------------|--------|---------------|------|
| TASK-001 | complete | DESIGN-001 | draft | Task complete but design not updated |
```

## Remediation Actions

### For Broken References

1. **Create the missing spec** if it should exist:

   ```powershell
   # Create missing design
   Copy-Item .agents/specs/design/DESIGN-001-template.md .agents/specs/design/DESIGN-999-new.md
   ```

2. **Update the source spec** if reference is incorrect:

   ```yaml
   # Fix TASK-001 front matter
   related:
     - DESIGN-001  # Changed from DESIGN-999
   ```

### For Untraced Tasks

Add the `related` field to YAML front matter:

```yaml
---
type: task
id: TASK-005
related:
  - DESIGN-001  # Add this line
---
```

### For Orphaned Requirements

Either:

1. **Create a design** that addresses the requirement
2. **Deprecate the requirement** if no longer needed (update status to `deprecated`)

### For Orphaned Designs

Either:

1. **Create tasks** to implement the design
2. **Deprecate the design** if no longer needed (update status to `deprecated`)

## Exit Codes

| Code | Meaning | CI Behavior |
|------|---------|-------------|
| 0 | No errors or warnings | Pass |
| 1 | Errors found | Fail |
| 2 | Warnings only (no errors) | Pass (unless `-Strict`) |

## Integration

### CI Pipeline

```yaml
- name: Validate Traceability
  run: pwsh scripts/Validate-Traceability.ps1 -Strict
  # Use -Strict in CI to catch orphans early
```

### Pre-Commit Hook

The pre-commit hook runs validation automatically when spec files are staged:

```text
# Checking specification traceability...
# Traceability validation: PASS
```

### Critic Agent

The critic agent includes traceability validation in its review checklist. Plans that create or modify specs must pass traceability validation.
