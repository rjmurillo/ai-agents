# Prompt Engineering Skills: Quality Gate Prompts

**Domain**: AI PR Quality Gate prompt modifications
**Source**: Session 91 (Issue #357), PR #466
**Effectiveness**: High (eliminated false positives, zero regressions)

## Pattern Library

### Pattern 1: PR Type Detection

**When to use**: Quality gate prompts need to apply different evaluation criteria by PR type

**Implementation**:
```markdown
## PR Type Detection

Categorize the PR before evaluation:

| File Patterns | Category |
|---------------|----------|
| `.md`, `.txt`, `.rst`, `docs/` | DOCS |
| `.cs`, `.py`, `.js`, `.ts`, `.go`, `.java` | CODE |
| `.github/workflows/*.yml` | WORKFLOW |
| `.json`, `.yml`, `.yaml`, `.toml`, `.xml` | CONFIG |

**PR Type Classification**:
- **Single-type**: 100% of files in one category
- **MIXED**: Files from 2+ categories
```

**Impact**: Prevents applying CODE evaluation criteria to DOCS-only PRs

**Evidence**: 4 PRs tested (DOCS, CODE, WORKFLOW, MIXED), zero false positives

### Pattern 2: Expected Patterns (False Positive Prevention)

**When to use**: Quality gate needs to distinguish legitimate patterns from issues

**Implementation**:
```markdown
## Expected Patterns (Do NOT flag as issues)

| Pattern | Why Acceptable | Example |
|---------|----------------|---------|
| Generated files | Auto-generated by tools | `*.Designer.cs`, `package-lock.json` |
| Test fixtures | Example data for testing | `testdata/malformed-*` |
| Type definitions | Interface declarations | `.d.ts` files with no implementation |
| Documentation examples | Placeholder credentials in docs | `your-api-key-here`, `example@example.com` |
```

**Impact**: Reduces noise, prevents legitimate patterns from triggering warnings

**Evidence**: Security prompt no longer flags `example@example.com` in docs; QA prompt no longer flags type definitions as "missing implementation"

### Pattern 3: Context-Aware CRITICAL_FAIL Thresholds

**When to use**: Different PR types have different failure criteria

**Implementation**:
```markdown
## Verdict Thresholds (Context-Aware)

### For DOCS-only PRs:
- **CRITICAL_FAIL**: Only if documentation introduces security vulnerabilities or incorrect technical guidance
- **PASS**: Documentation changes, typo fixes, structure improvements

### For CODE PRs:
- **CRITICAL_FAIL**: Security vulnerabilities, missing tests for new logic, breaking changes without migration path
- **PASS**: Well-tested code following patterns

### For WORKFLOW PRs:
- **CRITICAL_FAIL**: Unpinned actions, missing required checks, security context exposure
- **PASS**: Workflow improvements with pinned dependencies
```

**Impact**: DOCS-only PRs no longer receive CRITICAL_FAIL for "missing tests"

**Evidence**: PR #462 (DOCS-only) correctly returned PASS after pattern applied

### Pattern 4: Affirmative Directives (Not Negative)

**When to use**: Orchestrator or quality gate prompts need to prevent certain behaviors

**Before (Negative)**:
```markdown
## FORBIDDEN
- DO NOT run commands without delegating
- DO NOT skip memory retrieval
- DO NOT implement without planning
```

**After (Affirmative)**:
```markdown
## Delegate to Specialists

| Task Type | Delegate To | Reason |
|-----------|-------------|--------|
| Code implementation | implementer | Specialized for production code patterns |
| Research | analyst | Optimized for root cause analysis |
| Architecture | architect | Enforces ADR governance |
```

**Impact**: Clearer guidance, easier to follow

**Evidence**: Orchestrator prompt updated with affirmative directives (commit 8417dd7)

### Pattern 5: Error Normalization (Expected Edge Cases)

**When to use**: Some "errors" are actually normal behavior that should not trigger warnings

**Implementation**:
```markdown
## Expected Edge Cases (Normal Behavior)

| Scenario | Why Normal | Verdict |
|----------|------------|---------|
| Empty PR (git diff shows no changes) | Re-run of successful workflow | PASS |
| Generated files only | Auto-generated by build process | PASS (review generator config) |
| Config-only changes | Infrastructure updates | PASS (unless unpinned versions) |
```

**Impact**: Prevents noise from normal scenarios being flagged as issues

## Success Metrics (Session 91)

- **Prompts updated**: 3 quality gates + 2 orchestrator = 5 total
- **Patterns applied**: 5 (PR Type Detection, Expected Patterns, Context-Aware CRITICAL_FAIL, Affirmative Directives, Error Normalization)
- **Real PRs validated**: 4 (DOCS, CODE, WORKFLOW, MIXED)
- **Regressions detected**: 0
- **False positives eliminated**: Issue #357 class (DOCS-only CRITICAL_FAIL)

## Reference

**Source**: `.claude/skills/prompt-engineer/references/prompt-engineering-single-turn.md`

**Related Memories**:
- [retrospective-2025-12-27](retrospective-2025-12-27.md): Full Session 91 retrospective
- [issue-357-rca-findings](issue-357-rca-findings.md): Root cause analysis
- [ai-quality-gate-efficiency-analysis](ai-quality-gate-efficiency-analysis.md): Quality gate performance metrics

## When NOT to Use

These patterns are optimized for **single-turn AI evaluation**. Do NOT apply to:
- Multi-turn conversational agents (different prompt structure)
- Code generation prompts (different optimization goals)
- User-facing chatbot prompts (different tone/style requirements)

## Validation Protocol

Before merging prompt changes using these patterns:

1. **Structural validation**: Run `Invoke-Pester tests/QualityGatePrompts.Tests.ps1` (if test suite exists)
2. **Real-world validation**: Test against 4+ historical PRs covering all PR types (DOCS, CODE, WORKFLOW, MIXED)
3. **Regression check**: Verify no new false positives introduced
4. **Coverage check**: Confirm Expected Patterns section documents known acceptable patterns

**Evidence baseline**: 84 Pester tests covering file classification, PR type detection, DOCS exemptions, expected patterns, CRITICAL_FAIL triggers, cross-prompt consistency

## Related

- [skills-agent-workflow-index](skills-agent-workflow-index.md)
- [skills-agent-workflow-phase3](skills-agent-workflow-index.md)
- [skills-agent-workflows](skills-agent-workflows.md)
- [skills-analysis-index](skills-analysis-index.md)
- [skills-analysis](skills-analysis-index.md)
